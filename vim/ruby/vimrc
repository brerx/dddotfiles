let g:coc_global_extensions = g:coc_global_extensions + ['coc-solargraph']

function! s:AlternateSafe()
  try
    A
  catch /^Vim\%((\a\+)\)\=:E345:/
    let path = matchstr(v:exception, '.*"\zs.*\ze".*')
    execute 'e ' . path
  endtry
endfunction

command! AlternateSafe :call <SID>AlternateSafe()

augroup filetype_ruby
    autocmd!
    autocmd FileType ruby iab <buffer> de do<cr>end<esc>O
    autocmd FileType ruby iab <buffer> desc describe 'title' do<cr>end<esc>O
    autocmd FileType ruby iab <buffer> it it 'does' do<cr>end<esc>O
    autocmd FileType ruby iab <buffer> ctx context 'with sth' do<cr>end<esc>O
    autocmd FileType ruby iab <buffer> def def<cr>end<esc>kA
    autocmd FileType ruby iab <buffer> class class<cr>end<esc>kA
    autocmd FileType ruby iab <buffer> if if<cr>end<esc>kA
    autocmd FileType ruby iab <buffer> pry require 'pry'; binding.pry
augroup END

augroup skeletons_ruby
  autocmd BufNewFile,BufReadPost *_spec\.rb if getline(1,'$') == [''] | 0r $HOME/.dotfiles/vim/ruby/skeletons/spec.rb | endif
augroup END

let g:BufferNavigatorWidth = 50
let g:BufferNavigatorHighlightRules = [
      \["rubySpecDir", "dir", "spec", "NONE", "106", "NONE", "green"],
      \["rubySpecFile", "file", ".*_spec\.rb", "NONE", "154", "NONE", "green"],
      \]

source $HOME/.dotfiles/vim/ruby/mappings.vim
